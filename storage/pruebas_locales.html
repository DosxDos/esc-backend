<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pruebas de la APIREST</title>
</head>

<body>
    <h1>PRUEBAS DE LA APIREST</h1>
</body>
<script>
    /*
    fetch('http://localhost/esc-backend/usuarios', {
        method: 'GET',
        headers: {
            'usuario': 'soporte@galagaagency.com', // Cambia esto por el usuario que quieras enviar
            'apiKey': '14f4b345084262db658af2bf8d09745d6cf4a8450dd1d8333ca427f48ab484db34efe6'    // Cambia esto por tu API key
        }
    })
        .then(response => {
            // Verifica si la respuesta es exitosa
            if (!response.ok) {
                throw new Error(`Error en la solicitud: ${response.status}`);
            }
            console.log(response);
            return response.json(); // Convierte la respuesta a JSON
        })
        .then(data => {
            // Maneja la respuesta JSON aquí
            console.log('Respuesta de la API:', data);
        })
        .catch(error => {
            // Maneja errores en la solicitud
            console.error('Error:', error);
        });
    
    fetch('http://localhost/esc-backend/usuarios/250', {
        method: 'GET',
        headers: {
            'usuario': 'soporte@galagaagency.com', // Cambia esto por el usuario que quieras enviar
            'apiKey': '14f4b345084262db658af2bf8d09745d6cf4a8450dd1d8333ca427f48ab484db34efe6**'    // Cambia esto por tu API key
        }
    })
        .then(response => {
            // Verifica si la respuesta es exitosa
            if (!response.ok) {
                throw new Error(`Error en la solicitud: ${response.status}`);
            }
            console.log(response);
            return response.json(); // Convierte la respuesta a JSON
        })
        .then(data => {
            // Maneja la respuesta JSON aquí
            console.log('Respuesta de la API:', data);
        })
        .catch(error => {
            // Maneja errores en la solicitud
            console.error('Error:', error);
        });
        */

    const loginRequest = (json) => {
        return new Promise((resolve, reject) => {
            fetch('http://localhost/esc-backend/login', {
                method: 'POST',
                body: json,
                headers: {
                    'usuario': 'soporte@galagaagency.com',
                    'apiKey': '14f4b345084262db658af2bf8d09745d6cf4a8450dd1d8333ca427f48ab484db34efe6**'
                }
            })
                .then(response => {
                    // Verificar si el estado de la respuesta no es exitoso (códigos 4xx o 5xx)
                    if (!response.ok) {
                        // Verificar si fue un error de la API
                        //Intentar obtener el cuerpo de la respuesta como JSON
                        return response.clone().json().then(errorData => {
                            error = {
                                status: 'error',
                                code: response.status,
                                message: errorData.message || 'Error desconocido',
                                errors: errorData.errors || []
                            };
                            resolve(error);
                        })
                            .catch(() => {
                                // Si no es posible parsear el cuerpo como JSON, obtenerlo como texto
                                return response.text().then(errorText => {
                                    error = {
                                        status: 'error',
                                        code: response.status,
                                        message: errorText || 'Error desconocido',
                                        errors: []
                                    };
                                    resolve(error);
                                });
                            });
                    }
                    return response.clone().json().then(data => {
                        resolve(data);
                    })
                        .catch(() => {
                            // Si no es posible parsear el cuerpo como JSON, obtenerlo como texto
                            return response.text().then(errorText => {
                                error = {
                                    status: 'error',
                                    code: response.status,
                                    message: errorText || 'Error desconocido',
                                    errors: []
                                };
                                resolve(error);
                            });
                        });
                })
                .catch(error => {
                    // Verificar si el error fue de red
                    if (error.message === 'Failed to fetch') {
                        error = {
                            status: 'error',
                            code: 0,
                            message: 'Error de red: No se pudo conectar con el servidor.',
                            errors: []
                        };
                        resolve(error);
                    } else {
                        // Errores de otra naturaleza
                        error = {
                            status: 'error',
                            code: response.status,
                            message: errorData.message || 'Error desconocido',
                            errors: errorData.errors || []
                        };
                        resolve(error);
                    }
                });
        })
    }

    const login = async (object) => {
        json = JSON.stringify(object),
            response = await loginRequest(json);
        if (response.status == "error") {
            //Lógica para manejar una respuesta de error
            console.error(response);
            console.error(response.message);
        } else {
            //Lógica para manejar una respuesta exitosa
            console.log(response);
            console.log(response.message);
        }
    }

    userData = {
        email: "soporte@galagaagency.com",
        password: "Galaga2024!",
        idiomaUsuario: "es"
    };

    login(userData);

</script>

</html>